<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <script type="text/javascript" src="/static/angular.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/bower_components/bootstrap/css/bootstrap.css">

    <script src="/bower_components/jquery/jquery.min.js"></script>
    <script src="/bower_components/bootstrap/js/bootstrap.js"></script>

    <link rel="stylesheet" href="bower_components/angular-color-picker/dist/angularjs-color-picker.min.css" />
    <link rel="stylesheet" href="bower_components/angular-color-picker/dist/themes/angularjs-color-picker-bootstrap.min.css" />

    <script src="bower_components/tinycolor/dist/tinycolor-min.js"></script>
    <script src="bower_components/angular-color-picker/dist/angularjs-color-picker.min.js"></script>

    <link rel="stylesheet" href="/static/angular-ui-switch/angular-ui-switch.min.css"/>
    <script src="/static/angular-ui-switch/angular-ui-switch.min.js"></script>

    <style>
        span.selectedOption {
            font-weight: bold;
        }
    </style>
</head>
<body ng-app="LightManagerApp">
    <div ng-controller="LightManagerController">

        <div class="panel panel-default">

            <div class="panel-heading">
                <ul class="nav nav-pills">
                    <li class="active"><a href="#lightsTab" data-toggle="tab">Lights</a></li>
                    <li><a href="#heatersTab" data-toggle="tab">Heaters</a></li>
                    <li><a href="#notificationsTab" data-toggle="tab">Notifications</a></li>
                    <li class="pull-right"><a ng-click="buildInterface()" class="glyphicon glyphicon-refresh"></a></li>
                </ul>
             </div>



            <div class="panel-body">
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="lightsTab">
                        <ul class="list-group">
                            <li class="list-group-item" ng-repeat="light in lights">
                                {{ light.displayName }}
                                <span ng-repeat="interfaceOption in light.interface">
                                    <!-- NG MODDEL in the switch below is hardcoded, needs to be Dynamic! -->
                                    <switch
                                        ng-if="interfaceOption.type == 'switch'"
                                        id="{{ light.name }}OnOffSwitch"
                                        name="{{ light.name }}OnOffSwitch"
                                        on="{{ interfaceOption.options[0].displayName }}" off="{{ interfaceOption.options[1].displayName }}"
                                        ng-model="light.actualStatus.onOff"
                                        class="green"
                                        ng-change="sendLightCommand(this, interfaceOption.options[light.actualStatus.onOff == true ? 0 : 1 ].status )">
                                    </switch>
                                </span>

                            </li>
                        </ul>
                    </div> <!-- End of id="lightsTab" -->
                    <div class="tab-pane fade" id="notificationsTab">
                        <h3 class="panel-title">Notifications</h3>
                    </div>

                    <div class="tab-pane fade" id="heatersTab">
                        <h3 class="panel-title">Heaters</h3>
                    </div>
                </div> <!-- end tab-content -->
            </div>

        </div><!-- Closing panel panel-default -->
    </div>


    <!-- <color-picker ng-model="myColor" options="{round : true, alpha: false }"></color-picker> -->
</body>

<script type="text/javascript">
    angular.module("LightManagerApp", ['color.picker', 'uiSwitch'])
        .controller("LightManagerController", function($scope, $http){

            $scope.updateInterfaceWithResponse = function(response){
                $scope.lights = response;
            }

            $scope.buildInterface = function(){
                $http.get("/angular/getInterfaceOptions").success(function(response){
                    $scope.updateInterfaceWithResponse(response)
                });
            }

            $scope.updateInterface = function(){
                $http.get("/angular/getLightStatus").success(function(response){
                    $scope.updateInterfaceWithResponse(response)
                });
            }

            $scope.sendLightCommand = function(element, status){
                status.lightName = element.light.name;

                $http.post(
                    "/angular/runProgram",
                    status
                ).success(
                     $scope.buildInterface
                )
            }

            $scope.heyWhatsUp = function(a,b,c){
                console.log(a,b,c, this);
            }

            $scope.socketSimulator = function(){
                $http.get("/angular/socketSimulator", { timeout: 5000 })
                    .success(function(response){
                        $scope.updateInterfaceWithResponse(response)
                        $scope.socketSimulator()
                    })
                    .error(function(){
                        $scope.socketSimulator()
                    }
                )
            }

            $scope.buildInterface();
            $scope.socketSimulator();
        });

</script>
</html>